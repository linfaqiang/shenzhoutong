<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>神州通-订餐</title>
	    <meta name="description" content="">
		<meta name="Keywords" content="">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	    <meta content="yes" name="apple-mobile-web-app-capable">
	    <meta content="black" name="apple-mobile-web-app-status-bar-style">
	    <meta content="telephone=no" name="format-detection">
		<link rel="stylesheet" type="text/css" href="../css/libs/mui.picker.css"/>
		<link rel="stylesheet" type="text/css" href="../css/libs/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../css/libs/mui.poppicker.css"/>
		<link rel="stylesheet" href="../css/global/rest.css">
		<link rel="stylesheet" type="text/css" href="../css/orderingInfo.css"/>
		<link rel="stylesheet" type="text/css" href="../css/roomFood.css"/>
		
		<script type="text/javascript" charset="UTF-8">
			var win = window,doc = document;
			function setFontSize() {
			　　var winWidth = window.innerWidth;
			　　doc.documentElement.style.fontSize = (((winWidth>640?640:winWidth) / 640) * 100) + 'px';
			};
			setFontSize();
			win.onresize=setFontSize;
   		</script>
	</head>
	<body class="oder-Info waiterOrder mui-ios mui-ios-9 mui-ios-9-1">
		<div class="head">
		     <a href="javascript:history.go(-1);;"></a>
		     <span>我的订餐</span>
		</div>
		
		<div class="warp">
			<ul class="list-box">
                <input type="hidden" value="c0181154-877b-4004-859a-59e4b30857a1" name="ORDER_ID" id="ORDER_ID">
				<li>
					<span class="s must">
						用餐人：
					</span>
					<div class="ipt">
						<input class="parson" type="text" name="ORDER_NAME" id="ORDER_NAME" value="小黄" readonly="true">
					</div>
				</li>	
				
                <li>
					<span class="s must">
						任务编号：
					</span>
					<div class="ipt">
						<input class="parson read" type="text" name="" id="daskNumber" value="RW001" readonly="true">
					</div>
				</li>

				<li>
					<span class="s must">
						任务名称：
					</span>
					<div class="ipt">
						<input class="parson read" type="text" name="" id="daskName" value="就餐费用" readonly="true">
					</div>
				</li>

				<li>
					<span class="s must">
						申请金额：
					</span>
					<div class="ipt">
						<input class="parson read" type="text" name="" id="daskCount" value="500元" readonly="true">
					</div>
				</li>	

				<li>
					<span class="s must">
						用餐时间：
					</span>
					<div class="ipt">
						<input class="time" type="text" id="startTime" name="" data-options="{}" value="2017/3/3 13:59:00" placeholder="请选择用餐时间">
					</div>
				</li>
				
				<li class="numA">
					<span class="s must">
						用餐人数：
					</span>
					<div class="ipt no trans" style="transform: translateX(0px);">
						<div class="count">
							<div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" data-numbox-max="100">
							  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
							  <input class="mui-numbox-input" type="number" value="1">
							  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
							</div>
						</div>
					</div>
				</li>
				<li>
					<span class="s must">
						订单状态：
					</span>
					<div class="ipt">
						<span class="red">已预定待确认</span>
					</div>
				</li>
				<li class="br">
					<span class="s ">点餐列表：</span>
					<div class="ipt line-wrap" style="margin-top:0;">
						<hr>
					</div>
				</li>
				<li class="menu">
					<div class="left">
						<div class="primary"><img src="/Content/images/u99.png"></div>
					</div>
					<div class="right">
						<ul>
							    <li data-id="0" type-id="1">
								    <div class="trans" style="transform: translateX(0px);">
									    <div class="count">
										    <div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" data-numbox-max="100">
										      <button class="mui-btn numbox-btn-minus" type="button">-</button>
										      <input class="numberPut" type="number" value="3">
										      <button class="mui-btn numbox-btn-plus" type="button">+</button>
										    </div>
									    </div>
									    <div class="name">
										    <h2>1、辣椒炒肉</h2>										    <p>
											    <span class="price-area">18元	</span>
											    <span class="w-wap" data-wid="3">超辣</span>
											    <span class="q-wap" data-qid="3">偏咸</span>
										    </p>
									    </div>
								    </div>
								    <div class="remove" style="transform: translateX(0px);">
									    删除
								    </div>
							    </li>
							    <li data-id="1" type-id="1">
								    <div class="trans" style="transform: translateX(0px);">
									    <div class="count">
										    <div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" data-numbox-max="100">
										      <button class="mui-btn numbox-btn-minus" type="button">-</button>
										      <input class="numberPut" type="number" value="4">
										      <button class="mui-btn numbox-btn-plus" type="button">+</button>
										    </div>
									    </div>
									    <div class="name">
										    <h2>2、红烧排骨</h2>										    <p>
											    <span class="price-area">28元	</span>
											    <span class="w-wap" data-wid="1">微辣</span>
											    <span class="q-wap" data-qid="1">清淡</span>
										    </p>
									    </div>
								    </div>
								    <div class="remove" style="transform: translateX(0px);">
									    删除
								    </div>
							    </li>
							    <li data-id="2" type-id="2">
								    <div class="trans" style="transform: translateX(0px);">
									    <div class="count">
										    <div class="mui-numbox" data-numbox-step="1" data-numbox-min="0" data-numbox-max="100">
										      <button class="mui-btn numbox-btn-minus" type="button">-</button>
										      <input class="numberPut" type="number" value="2">
										      <button class="mui-btn numbox-btn-plus" type="button">+</button>
										    </div>
									    </div>
									    <div class="name">
										    <h2>3、刀拍黄瓜</h2>										    <p>
											    <span class="price-area">12元	</span>
											    <span class="w-wap" data-wid="3">超辣</span>
											    <span class="q-wap" data-qid="2">正常</span>
										    </p>
									    </div>
								    </div>
								    <div class="remove" style="transform: translateX(0px);">
									    删除
								    </div>
							    </li>
						</ul>
					</div>
				</li>
                <!--加减菜：-->
				<li class="add-li" style="display: none;">
				  <span>加减菜：</span>
				 
				</li>
				<li class="sumAll">
					<span>数量：<i class="deshNum">2</i></span>
					<span>合计：<i class="deshTotal">244</i></span>
				</li>
				<hr>
				<li>
					<span class="s ">
						备注：
					</span>
					<div class="ipt ">
						<textarea></textarea>
					</div>
				</li>
			</ul>
			<div class="btn-wrap">
				<button>不接受预定</button>
				<button>接受预定</button>
			</div>
		</div>
		<script src="../libs/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>
		<script src="../libs/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/waiter-addFood.js" type="text/javascript" charset="utf-8"></script>
		<script src="../libs/mui.picker.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../js/waiterOrderInfo.js"></script>
		<script type="text/javascript">
		    (function ($, doc, jq) {
		        $.init();
		        $.ready(function () {
		            var startTime = document.querySelector('#startTime');
		            startTime.addEventListener('tap', function () {
		                var that = this;
		                var optionsJson = jQuery("#serverTime").attr('data-options') || '{}';
		                var options = JSON.parse(optionsJson);
		                var now=new Date();
							options.beginYear=now.getFullYear();
							options.beginMonth=now.getMonth()+1;
							options.beginDay=now.getDate();
							options.beginHours=now.getHours()+1;
		                var id = jQuery("#serverTime").attr('id');
		                var picker = new $.DtPicker(options);
		                picker.show(function (rs) {
		                    that.value = rs.value;
		                    picker.dispose();
		                    
		                });
		            }, false);
		            
		        });
//		        document.querySelector('.parson').addEventListener('tap', function () {
//		            var that = this;
//		            var picker1 = new mui.PopPicker();
//		            picker1.setData([{ value: 'zz', text: '小伙子-董事长' }, { value: 'zz', text: '小胖子-工程师' }, { value: 'zz', text: '大傻子-跑腿'}]);
//		            picker1.show(function (rs) {
//		                that.value = rs[0].text;
//		            });
//		        }, false);

		    })(mui, document, jQuery);
		</script>
		<script type="text/javascript">
		    $(document).ready(function () {
		        //获取点菜页面缓存的数据并解析
		        if (document.referrer.indexOf("OrderPerson/DeliciousFood") >= 0) {
		            var _WaiterOrderInfo_Data = window.sessionStorage.WaiterOrderInfo_Data;
		            alert(_WaiterOrderInfo_Data);
		            if (_WaiterOrderInfo_Data) {
		                var _json = JSON.parse(_WaiterOrderInfo_Data)
		                $(".deshTotal").html(_json.totalPrice);
		                $(".deshNum").html(_json.totalNum);
		                $("#ORDER_ID").val(_json.ORDER_ID);
		                $("#startTime").val(_json.DINNER_TIME);
		                $(".mui-numbox-input").val(_json.NUMBER_DINE);
		                $(".ipt textarea").html(_json.REMARKS);
		                var _productList = _json.productList;
		                if (_productList) {
		                    for (var i = 0; i < _productList.length; i++) {
		                        var _data = '<div class="name-wrap"><h2>' + (i + 1) + '、' + _productList[i].PRODUCT_NAME + '</h2><p>数量：+<b>' + _productList[i].num + '</b></p></div>';
		                        $(".add-li").append(_data);
		                    }
		                }

		            }
		        }

		        function selectTime(node){
		        	var startTime = document.querySelector(node);
		        	var value=startTime.value.replace(/-/ig,"/");
		            var currentTime=new Date().getTime();
		            var selectTime=new Date(value).getTime();
		            if(selectTime<currentTime){
		            	mui.toast('时间过了，请再次选择！');
		            	return false;
		            }
		        }
		        selectTime('#startTime');
		        //接受预定
		        $('.btn-wrap button').eq(1).on('click', function () {
		        	selectTime('#startTime','时间过了，请再次选择！');
		            var _data = getData();
		            $.post('/Server/WaiterOrderInfoSubmit', { content: _data }, function (data) {
		                if (data == 1) {
		                    alert("操作成功");
                            window.location.href="/Server/WaiterWaitHandleList";
		                }
		                else {
		                    alert("操作失败");
                        }
		            });
		        });
		        //不接受预定
		        $('.btn-wrap button').eq(0).on('click', function () {
		            var _data = { id: $("#ORDER_ID").val() };
		            $.post('/Server/WaiterOrderInfoReservationFailed', _data, function (data) {
                      if (data == 1) {
		                    alert("操作成功");
                            window.location.href="/Server/WaiterOrderInfoReservationFailed";
		                }
		                else {
		                    alert("操作失败");
                        }
                     });
		        });

		       
		    });

//		    function getData() {
//		        return '{"DINNER_TIME":"2017/03/03 09:43:44","NUMBER_DINE":"6","REMARKS":"这是备注","ORDER_ID":"c0181154-877b-4004-859a-59e4b30857a1","productList":[{"PRODUCT_NAME":"辣椒炒肉","PRODUCT_ID":"cb8cd027-2c2a-4282-8858-09f21c51da3a","num":"5","SPICY_ID":"1","TASTE_ID":"2","CATEGORY_ID":"1"},{"PRODUCT_NAME":"红烧排骨","PRODUCT_ID":"ba70d555-8b17-42df-985d-3df877eb9e7b","num":"3","SPICY_ID":"3","TASTE_ID":"3","CATEGORY_ID":"1"}]}'
//            }

//		    //模拟post打开新页面
//		    function post(URL, PARAMS) {
//		        var temp_form = document.createElement("form");
//		        temp_form.action = URL;
//		        temp_form.target = "_self";
//		        temp_form.method = "post";
//		        temp_form.style.display = "none";
//		        var opt = document.createElement("textarea");
//		        opt.name = "content";
//		        opt.value = PARAMS;
//		        temp_form.appendChild(opt);
//		        document.body.appendChild(temp_form);
//		        temp_form.submit();
//		    }
		</script>
	


</body>
</html>
