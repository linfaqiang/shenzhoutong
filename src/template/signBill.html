<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>神州通-签单</title>
	    <meta name="description" content="">
		<meta name="Keywords" content="">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	    <meta content="yes" name="apple-mobile-web-app-capable">
	    <meta content="black" name="apple-mobile-web-app-status-bar-style">
	    <meta content="telephone=no" name="format-detection">
		<link rel="stylesheet" href="../css/global/rest.css">
		<link rel="stylesheet" type="text/css" href="../css/orderInfoConfirm.css"/>
		<link rel="stylesheet" type="text/css" href="../css/signBill.css"/>
		
		<script type="text/javascript" charset="UTF-8">
			var win = window,doc = document;
			function setFontSize() {
			　　var winWidth = window.innerWidth;
				winWidth = winWidth<320 ? 320 : winWidth;
			　　doc.documentElement.style.fontSize = (((winWidth>640?640:winWidth) / 640) * 100) + 'px';
			};
			setFontSize();
			win.onresize=setFontSize;
   		</script>
   		<style type="text/css">
   		
   		</style>
	</head>
	<body>
		<div class="orderInfoConfirm signBill">
			<div class="head fexid">
		     	<a href="javascript:history.go(-1);;"></a>
		     	<span>签单</span>
			</div>
		
			<div class="content">
				
				<ul>
					<li>
						<div >
							订餐编号：
						</div>
						<div >
							0701200001  <span class="fr">创建人：<u>小伙子</u></span>
						</div>
						
					</li>
					<li>
						<div >
							订餐时间：
						</div>
						<div >
							2017-01-18  12:10:00
						</div>
						
					</li>
					<li>
						<div >
							用餐时间：
						</div>
						<div >
							2017-01-20  12:00:00  <span class="fr">用餐人数：  <u>8人</u></span>
						</div>
						
					</li>
					<li>
						<div >
							预订台面：
						</div>
						<div >
							聚宝楼、岳阳楼  <span class="fr">用餐人数：  <u>8人</u></span>
						</div>
					</li>
					<li class="border_B">
						<div >
							订餐人：
						</div>
						<div >
							陈言
						</div>
						
					</li>
					
					<li><div >
							订单状态：
						</div>
						<div style="padding-left: 1.3rem;line-height: .3rem;">
							待签单（已经算）
						</div>
						
						
						
					</li>
					<li class="border_B">
						<div >
							服务员：
						</div>
						<div >
							<span>刘园园</span>
							<div style="float: right;">
								结单时间：<span class="Date">2015-07-13 12:00:00</span>
							</div>
						</div>
					</li>
					
					
					
					<li style="padding-bottom:.09rem;">
					
						<div >
							点餐列表：
						</div>
						<div class="menuL oderList">
							<!-- <p style="float: right;">单品评价</p> -->
							<dl>
							    <dt>
									<span>菜品名</span>
									<span>数量</span>
									<p>单价</p>
									<div class="flavor" style="text-align: center;">评价</div>
								</dt>
								<dd>
									<span>1、红烧牛肉</span>
									<span><i class="red num">1</i>份</span>
									<p class="price">30元</p>
									<div class="hotZ">
										<a class="goodUp" href="javascript:;"></a>
										<a class="goodDown" href="javascript:;"></a>
									</div>
								</dd>
								<dd>
									<span>2、红烧牛肉</span>
									<span><i class="red num">1</i>份</span>
									<p class="price">30元</p>
									<div class="hotZ">
										<a class="goodUp" href="javascript:;"></a>
										<a class="goodDown" href="javascript:;"></a>
									</div>
								</dd>
								<dd>
									<span>3、红烧牛肉</span>
									<span><i class="red num">1</i>份</span>
									<p class="price">30元</p>
									<div class="hotZ">
										<a class="goodUp" href="javascript:;"></a>
										<a class="goodDown" href="javascript:;"></a>
									</div>
								</dd>
								<dd>
									<span>4、红烧牛肉</span>
									<span><i class="red num">1</i>份</span>
									<p class="price">30元</p>
									<div class="hotZ">
										<a class="goodUp" href="javascript:;"></a>
										<a class="goodDown" href="javascript:;"></a>
									</div>
								</dd>
							</dl>
							
						</div>
					</li>
					<!--加减菜-->
					<li style="padding-top: 0;">
						<div style="line-height: .5rem">
							加减菜：
						</div>
						<div class="menuL add-list">
							<dl>
								<dt>
									<span>3、红烧牛肉</span>
									<span><i class="red num">-1</i>份</span>
									<p class="price">30元</p>
									<div class="hotZ">
										<a class="goodUp" href="javascript:;"></a>
										<a class="goodDown" href="javascript:;"></a>
									</div>
								</dt>
								<dt>
									<span>4、红烧牛肉</span>
									<span><i class="red num">+1</i>份</span>
									<p class="price">30元</p>
									<div class="hotZ">
										<a class="goodUp" href="javascript:;"></a>
										<a class="goodDown" href="javascript:;"></a>
									</div>
								</dt>
							</dl>
							
						</div>				
					</li>
					<!--统计数量和金额-->
					<li style="padding: .06rem .15rem">
					    <div></div><div class="menuL">数量：<span>8</span><p class="fr">小计：<span class="count">100.00</span>元</p><div>
					</li>
					<li style="padding: .06rem .15rem; padding-bottom: .15rem; border-bottom:1px solid #ddd; overflow:hidden;">
					    <div>其他：</div><div class="menuL">收取其他服务费<p class="fr">金额：<span class="otherCount">100.00</span>元</p><div>
					    <div style="padding-top: .1rem"></div><div class="menuL" style="padding-top: .1rem"><p class="fr">合计：<span class="totalCount">100.00</span>元</p><div>
					</li>
					<li class="evaluate">
						<div >
							服务评价：
						</div>
						<div class="result">
							<span></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
						
					</li>
					
					<li  class="evaluate">
						<div >
							菜品评价：
						</div>
						<div class="result">
							<span></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
						
					</li>
					
					<li class="evaluate">
						<div >
							环境评价：
						</div>
						<div class="result">
							<span ></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
						</div>
						
					</li>
					
					<li>
						<div >
							备注：
						</div>
						<div class="menuL message">
							<textarea noresize="noresize" name="" rows="" cols=""></textarea>
						</div>
						
					</li>
				</ul>
				
				<div class="btn">
					<a class="blank" href="javascript:;">打回</a>
					<a class="confirm" href="javascript:;">确认</a>	
				</div>
				
				
			</div>
		
		</div>
		
		<div class="opacity-container"></div>
        <div class="flag-container">
            <div class="flag-title">打回原因</div>
            <div class="flag-content"><textarea placeholder="请输入..."></textarea></div>
            <div class="flag-btn"><button>确定</button></div>
        </div>
		<div class="tips-container"></div>
		
		<script src="../libs/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$(function(){
				//评价
				$('.evaluate').find('span').on('click', function(){					
					$(this).siblings().removeClass('active');
					$(this).addClass('active').prevAll().addClass('active').parent().attr('data-num',$(this).index()+1)				
				});
				//点赞好
				$('.goodUp').on('click',function(){
					if($(this).hasClass('active')){
						$(this).removeClass('active');
					}else{
						$(this).addClass('active');
						$(this).siblings().removeClass('active');
						$(this).siblings().removeAttr('data-active');
						$(this).attr('data-active',1);
					}
				});
				//点赞差
				$('.goodDown').on('click',function(){
					if($(this).hasClass('active')){
						$(this).removeClass('active');
					}else{
						$(this).addClass('active');
						$(this).siblings().removeClass('active');
						$(this).siblings().removeAttr('data-active');
						$(this).attr('data-active',-1);
					}
				});
				//打回
				$('.blank').on('click',function(){
					$('.opacity-container').show();
					$('.flag-container').show();
				});
				$('.flag-btn button').on('click',function(){
					var textareaValue=$('.flag-content textarea').val();
					if(textareaValue==''){
                       flag('.tips-container','打回原因不能为空！','1rem',2000,500);
					}else{
					   $('.opacity-container').hide();
					   $('.flag-container').hide();
					}
				});
				
				function flag(node,text,h,time,speed){
			         $(node).html(text).stop().animate({height: h,lineHeight: h,opacity: 1},speed);setTimeout(function(){$(node).html('').stop().animate({height: 0,lineHeight: 0,opacity: 0},speed);},time);
			        }

			    //金额计算
				function Amount(nodeNum,nodePrice,nodeCount,otherCount,totalCount){
				    this.number=document.getElementsByClassName(nodeNum);
				    this.prices=document.getElementsByClassName(nodePrice);
				    this.count =document.querySelector(nodeCount);
				    this.otherCount =document.querySelector(otherCount);
				    this.totalCount =document.querySelector(totalCount);
				 }
				Amount.prototype.showCount=function(){
				 	this.count.innerHTML=0;
				 	this.totalCount.innerHTML=0;
				 	var count=0,totalCount=0;
				 	for(var i=0;i<this.number.length;i++){
				    var area=this.prices[i].innerHTML.substring(0,this.prices[i].innerHTML.length-1);
				        count+=parseInt(this.number[i].innerHTML)*parseFloat(area);
				    }
				    count=count.toFixed(2);
				    this.count.innerHTML=count;
				    var otherCount=parseFloat(this.otherCount.innerHTML);
				        totalCount=(parseFloat(count)+otherCount).toFixed(2);
				    this.totalCount.innerHTML=totalCount;
				};
				//实例对象
				var amount=new Amount('num','price','.count','.otherCount','.totalCount');
           	     amount.showCount();
			});
		</script>
		<script type="text/javascript">
           $(document).ready(function(){
                //点菜获取数据
			    function getData() {
			        var dataItem = {};
			        var order=[];
			        //var content = [];
			        //var addContent = [];
			        //dataItem.ORDER_ID = $("#ORDER_ID").val();
			        //dataItem.DINNER_TIME = $('.list-box li').eq(4).find('input').val();
			        //dataItem.NUMBER_DINE = $('.list-box li').eq(5).find('input').val();
			        //dataItem.REMARKS = $('textarea').val();
			        //点菜
			        $('.oderList dl dd').each(function(index){
                       var oderList={};
                       if($('.oderList dl dd').eq(index).find('a').hasClass('active'))
                       {
                        oderList.like=$('.oderList dl dd').eq(index).find('.active').attr('data-active');
                       }
                       
                       order.push(oderList);
			        });
			        dataItem.service=$('.result').eq(0).attr('data-num');
			        dataItem.desh=$('.result').eq(1).attr('data-num');
			        dataItem.envirnment=$('.result').eq(2).attr('data-num');
			        //加菜
			        /*$('.add-list dl dt').each(function (index) {
			            var add = {};
			            add.PRODUCT_NAME = $('.add-list dl dt').eq(index).find('h2').html();
			            add.PRODUCT_ID = $('.add-list dl dt').eq(index).attr("data-index");
			            add.SPICY_ID = $('.add-list dl dt').eq(index).attr("data-wid");
			            add.TASTE_ID = $('.add-list dl dt').eq(index).attr("data-qid");
			            add.CATEGORY_ID = $('.add-list dl dt').eq(index).attr("type-id");
			            add.num = $('.add-list dl dt').eq(index).find('b').html();
			            addContent.push(add);
			        });*/
			        dataItem.productList = order;
			        //return JSON.stringify(dataItem);
			        console.log(dataItem);
			        return dataItem; 
			    }

			    $('.confirm').on('click',function(){
			    	getData();
			    });

           });
		</script>
		
		
		
	</body>
</html>
